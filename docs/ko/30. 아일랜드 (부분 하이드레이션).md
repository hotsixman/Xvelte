# 30. 아일랜드 (부분 하이드레이션)

Xvelte의 핵심 기능 중 하나는 **아일랜드 아키텍처**, 또는 **부분 하이드레이션(Partial Hydration)**이라 불리는 렌더링 전략입니다. 이 접근 방식은 웹사이트의 초기 로딩 성능을 극대화하는 것을 목표로 합니다.

## 기존 하이드레이션의 문제점

전통적인 서버 사이드 렌더링(SSR) 프레임워크는 서버에서 생성된 HTML을 클라이언트로 보낸 후, 페이지 전체에 해당하는 JavaScript를 다운로드하여 DOM 요소에 이벤트 핸들러와 상태를 연결하는 '하이드레이션' 과정을 거칩니다. 이 방식은 페이지의 모든 컴포넌트가 상호작용이 가능해지지만, 페이지가 복잡할수록 JavaScript의 양이 많아져 초기 로딩 및 상호작용 가능 시간(TTI)이 길어지는 단점이 있습니다.

## Xvelte의 해결책: 아일랜드

Xvelte는 이 문제를 '아일랜드'라는 개념으로 해결합니다. 전체 페이지를 거대한 대륙으로 본다면, 상호작용이 필요한 부분(예: 버튼, 이미지 슬라이더, 자동완성 검색창)만 '섬(Island)'으로 취급하는 것입니다.

- **기본은 정적 HTML**: 페이지의 대부분은 상호작용이 없는 순수 HTML로 유지됩니다.
- **섬만 활성화**: 상호작용이 필요한 컴포넌트만 JavaScript를 통해 '활성화(하이드레이션)'됩니다.

이를 통해 클라이언트는 페이지를 그리는 데 필요한 최소한의 JavaScript만 다운로드하고 실행하므로, 사용자는 훨씬 빠르게 페이지를 보고 상호작용할 수 있습니다.

## 사용 방법

Xvelte에서는 `<Island>`라는 내장 컴포넌트를 사용하여 매우 쉽게 아일랜드를 지정할 수 있습니다.

**중요**: `<Island>` 컴포넌트에 전달하는 모든 컴포넌트는 클라이언트에서 렌더링되어야 함을 명시하기 위해, import 경로 끝에 `?client`를 붙여야 합니다. 이는 Xvelte 빌드 시스템에 해당 컴포넌트의 JavaScript를 클라이언트로 보내야 한다는 것을 알려주는 역할을 합니다.

```svelte
<!-- page/Index.svelte -->
<script>
    import Counter from '../components/Counter.svelte?client';
    import Island from '@hotsixman/xvelte/components/Island.svelte';
</script>

<h1>정적인 컨텐츠</h1>
<p>이 부분은 하이드레이션되지 않습니다.</p>

<!-- Counter 컴포넌트를 아일랜드로 지정 -->
<Island component={Counter} props={{ initialValue: 5 }} />
```

위 예제에서 `<h1>`과 `<p>` 태그는 순수 HTML로 유지되지만, `<Island>`로 감싸진 `Counter` 컴포넌트만 클라이언트에서 하이드레이션되어 상호작용이 가능해집니다.

### 하이드레이션 시점 제어

`<Island>` 컴포넌트의 `on` prop을 사용하여 JavaScript를 로드하고 컴포넌트를 활성화하는 시점을 제어할 수 있습니다. 이는 성능 최적화에 매우 유용합니다.

-   **`on="visible"`**: 사용자가 스크롤하여 컴포넌트가 뷰포트(화면)에 처음 보일 때 활성화됩니다. 페이지 하단에 있는 컴포넌트에 사용하면 좋습니다.
-   **`on="click"`**: 컴포넌트를 처음 클릭했을 때 활성화됩니다. 모달 창이나 드롭다운 메뉴처럼 즉각적인 상호작용이 필요 없는 경우에 적합합니다.
-   **`on="mouseenter"`**: 사용자가 컴포넌트 영역에 마우스 커서를 올렸을 때 활성화됩니다.
-   **`on` prop을 지정하지 않을 경우**: 페이지가 로드되자마자 즉시 활성화됩니다.

```svelte
<script>
    import HeavyComponent from '../components/HeavyComponent.svelte';
    import Island from '@hotsixman/xvelte/components/Island.svelte';
</script>

<!-- 화면에 보일 때만 로드되는 무거운 컴포넌트 -->
<Island component={HeavyComponent} on="visible" />
```

이처럼 Xvelte의 아일랜드 기능은 성능 최적화에 유용합니다.
