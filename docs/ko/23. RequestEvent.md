# 23. RequestEvent

`RequestEvent` 객체는 Xvelte의 모든 라우트 핸들러(페이지 및 엔드포인트)와 훅에 전달되는 객체입니다. 들어오는 HTTP 요청을 나타내며, 응답을 생성하고 제어하는 데 필요한 모든 속성과 메소드를 제공합니다.

## 주요 속성

| 속성             | 타입                               | 설명                                                                                             |
| ---------------- | ---------------------------------- | ------------------------------------------------------------------------------------------------ |
| `url`            | `URL`                              | 요청 URL에 대한 정보가 담긴 표준 `URL` 객체입니다. `url.pathname`, `url.searchParams` 등으로 사용합니다. |
| `params`         | `object`                           | 동적 라우팅에서 추출된 파라미터를 담는 객체입니다. 예를 들어, `/users/:id` 경로에 `/users/123`으로 요청이 오면 `params`는 `{ id: '123' }`이 됩니다. |
| `requestHeaders` | `object`                           | 요청의 모든 HTTP 헤더를 담고 있는 객체입니다.                                                    |
| `locals`         | `object`                           | 요청의 생명주기 동안 데이터를 저장하고 공유하기 위한 객체입니다. 훅에서 `locals`에 저장한 데이터는 라우트 핸들러에서 접근할 수 있습니다. |
| `method`         | `string`                           | 요청의 HTTP 메소드입니다 (예: 'get', 'post'). 소문자로 제공됩니다.                               |
| `status`         | `number`                           | 응답으로 보낼 HTTP 상태 코드입니다. 기본값은 `200`이며, 핸들러 내에서 변경할 수 있습니다.         |
| `cookie`         | `object`                           | 쿠키를 쉽게 다룰 수 있는 유틸리티 객체입니다.                                                    |
| `response` | `IncomingMessage` | nodejs http 모듈에서 사용하는 요청 객체입니다. |
| `request` | `ServerResponse` | nodejs http 모듈에서 사용하는 응답 객체입니다. |

## 주요 메소드

### 요청 분석

-   **`async text(): Promise<string>`**
    요청 본문을 UTF-8 문자열로 읽어 반환합니다.

-   **`async json(): Promise<any>`**
    요청 본문을 JSON으로 파싱하여 JavaScript 객체로 반환합니다.

-   **`async blob(): Promise<Blob>`**
    요청 본문을 `Blob` 객체로 반환합니다.

-   **`async buffer(): Promise<Buffer>`**
    요청 본문을 Node.js의 `Buffer` 객체로 반환합니다.

-   **`async form(): Promise<{ fields: object, files: object }>`**
    `multipart/form-data` 형식의 요청 본문(폼 데이터)을 파싱합니다. 텍스트 필드와 업로드된 파일을 포함하는 객체를 반환합니다.

-   **`getClientAddress(): string`**
    클라이언트의 IP 주소를 반환합니다.

### 응답 제어

-   **`setHeader(key: string, value: string | number | string[]): void`**
    응답에 HTTP 헤더를 설정합니다.

-   **`cookie.get(key: string): string | null`**
    요청에서 특정 키를 가진 쿠키 값을 읽습니다.

-   **`cookie.set(key: string, value: string, options: object): void`**
    응답에 쿠키를 설정합니다. `options` 객체를 통해 `path`, `maxAge`, `httpOnly` 등을 지정할 수 있습니다.

-   **`cookie.delete(key: string, options: object): void`**
    특정 쿠키를 삭제하도록 응답을 설정합니다.

## 사용 예제

```ts
app.post('/api/profile', async (event) => {
  // 클라이언트 IP 로깅
  console.log('Client IP:', event.getClientAddress());

  // 폼 데이터 파싱
  const { fields, files } = await event.form();
  const username = fields.username;
  const avatar = files.avatar; // { filename, mimeType, buffer }

  // ... 파일 저장 및 데이터베이스 업데이트 로직 ...

  // 응답 상태 및 헤더 설정
  event.status = 201;
  event.setHeader('X-Custom-Header', 'Success');

  // 쿠키 설정
  event.cookie.set('username', username, { path: '/', httpOnly: true });

  // JSON 응답 반환
  event.setHeader('Content-Type', 'application/json');
  return JSON.stringify({ success: true, username });
});
```
