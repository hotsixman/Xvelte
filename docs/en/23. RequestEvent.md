# 23. RequestEvent

The `RequestEvent` object is passed to all of Xvelte's route handlers (pages and endpoints) and hooks. It represents the incoming HTTP request and provides all the properties and methods needed to generate and control the response.

## Key Properties

| Property         | Type              | Description                                                                                                                               |
| ---------------- | ----------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| `url`            | `URL`             | A standard `URL` object containing information about the request URL. Used as `url.pathname`, `url.searchParams`, etc.                      |
| `params`         | `object`          | An object containing parameters extracted from dynamic routing. For example, if a request is made to `/users/123` for the path `/users/:id`, `params` will be `{ id: '123' }`. |
| `requestHeaders` | `object`          | An object containing all HTTP headers of the request.                                                                                     |
| `locals`         | `object`          | An object for storing and sharing data during the request's lifecycle. Data saved in `locals` in a hook can be accessed in the route handler. |
| `method`         | `string`          | The HTTP method of the request (e.g., 'get', 'post'). Provided in lowercase.                                                              |
| `status`         | `number`          | The HTTP status code to be sent in the response. The default is `200` and can be changed within the handler.                               |
| `cookie`         | `object`          | A utility object for easily handling cookies.                                                                                             |
| `response`       | `IncomingMessage` | The request object used by the Node.js http module.                                                                                       |
| `request`        | `ServerResponse`  | The response object used by the Node.js http module.                                                                                      |

## Key Methods

### Request Analysis

-   **`async text(): Promise<string>`**
    Reads the request body as a UTF-8 string and returns it.

-   **`async json(): Promise<any>`**
    Parses the request body as JSON and returns it as a JavaScript object.

-   **`async blob(): Promise<Blob>`**
    Returns the request body as a `Blob` object.

-   **`async buffer(): Promise<Buffer>`**
    Returns the request body as a Node.js `Buffer` object.

-   **`async form(): Promise<{ fields: object, files: object }>`**
    Parses a `multipart/form-data` request body (form data). Returns an object containing text fields and uploaded files.

-   **`getClientAddress(): string`**
    Returns the client's IP address.

### Response Control

-   **`setHeader(key: string, value: string | number | string[]): void`**
    Sets an HTTP header for the response.

-   **`cookie.get(key: string): string | null`**
    Reads the value of a specific cookie from the request.

-   **`cookie.set(key: string, value: string, options: object): void`**
    Sets a cookie in the response. You can specify `path`, `maxAge`, `httpOnly`, etc., through the `options` object.

-   **`cookie.delete(key: string, options: object): void`**
    Sets the response to delete a specific cookie.

## Usage Example

```ts
app.post('/api/profile', async (event) => {
  // Log client IP
  console.log('Client IP:', event.getClientAddress());

  // Parse form data
  const { fields, files } = await event.form();
  const username = fields.username;
  const avatar = files.avatar; // { filename, mimeType, buffer }

  // ... file saving and database update logic ...

  // Set response status and headers
  event.status = 201;
  event.setHeader('X-Custom-Header', 'Success');

  // Set cookie
  event.cookie.set('username', username, { path: '/', httpOnly: true });

  // Return JSON response
  event.setHeader('Content-Type', 'application/json');
  return JSON.stringify({ success: true, username });
});
```
