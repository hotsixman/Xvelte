# 22. Endpoint Routing

Xvelte provides a routing system for creating API endpoints on the server. It works in a way similar to Express.js, making it familiar to use.

## Handler Registration

You register endpoint handlers using methods corresponding to HTTP methods on the `XvelteApp` instance.

-   `app.get(path, handler)`
-   `app.post(path, handler)`
-   `app.put(path, handler)`
-   `app.delete(path, handler)`
-   `app.all(path, handler)`: Handles all methods

```ts
// src/app.ts
import XvelteApp from '@hotsixman/xvelte';
import template from './app.html?raw';

const app = new XvelteApp(template);

// GET /api/items
app.get('/api/items', (event) => {
  const items = [{ id: 1, name: 'Xvelte' }];

  // Set Content-Type and return as a JSON string.
  event.setHeader('Content-Type', 'application/json');
  return JSON.stringify(items);
});

// POST /api/items
app.post('/api/items', async (event) => {
  const newItem = await event.json(); // Parse request body as JSON
  console.log(newItem);
  event.status = 201; // Set response status code (Created)

  event.setHeader('Content-Type', 'application/json');
  return JSON.stringify({ success: true, message: 'Item created' });
});
```

## Dynamic Routing

You can handle dynamic parameters using the `path-to-regexp` library. Parameters can be accessed via the `event.params` object.

```ts
// GET /api/users/:id
app.get('/api/users/:id', (event) => {
  const userId = event.params.id;
  const user = db.findUserById(userId);

  if (user) {
    event.setHeader('Content-Type', 'application/json');
    return JSON.stringify(user);
  } else {
    event.status = 404;
    return 'User not found';
  }
});
```

## `RequestEvent` Object

All handlers receive a `RequestEvent` object as an argument, which can be used to analyze the request and control the response. For more details, refer to the [RequestEvent](./23.%20RequestEvent.md) documentation.

## Handler Return Values

Handlers can return various types of values to respond to the client.

- ArrayBuffer
- Uint8Array
- Blob
- Buffer
- FormData
- ReadStream
- string
- URLSearchParams
- false
- null

Returning `null` here simply terminates the handler, not the response. To end the response, you must use methods like `event.response.end()`.

Returning `false` passes control to the next handler without processing the response.

**Important:** Returning a plain object will not automatically convert it to JSON. To send a JSON response, you must convert it to a string using `JSON.stringify()` and set the `Content-Type` header to `application/json`.
